--mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.slf4j.Slf4jImpl



## Jar

```bash
@echo off
echo.
echo [信息] 使用Jar命令运行Gateway工程。
echo.

cd %~dp0
cd ../ruoyi-gateway/target

set JAVA_OPTS=-Xms512m -Xmx1024m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=512m

java -Dfile.encoding=utf-8 %JAVA_OPTS% -jar ruoyi-gateway.jar

cd bin
pause
```

-Xms分配堆最小内存，默认为物理内存的1/64；-Xmx分配最大内存，默认为物理内存的1/4。
非堆内存分配用-XX:PermSize和-XX:MaxPermSize

-XX:PermSize分配非堆最小内存，默认为物理内存的1/64；-XX:MaxPermSize分配最大内存，默认为物理内存的1/4。



      -XX:+UseContainerSupport -XX:InitialRAMPercentage=60.0
      -XX:MaxRAMPercentage=60.0 -XX:MetaspaceSize=256M
      -XX:MaxMetaspaceSize=256M -XX:NewRatio=1 -XX:SurvivorRatio=4
      -XX:NativeMemoryTracking=summary -XX:+PrintGCDetails
      -XX:+PrintGCDateStamps -XX:+PrintGCCause -XX:+UseGCLogFileRotation 
      -XX:+PrintHeapAtGC -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=20M 
      -Xloggc:/app/logs/gc-%t.log -XX:+HeapDumpOnOutOfMemoryError 
      -XX:HeapDumpPath=/app/logs/



```bash

# 1. 查找目标Java进程PID
jps -l

# 2. 使用jmap导出
jmap -dump:live,format=b,file=heap.hprof <PID>

# 3. 压缩文件（可选）
gzip heap.hprof


## jcmd <PID> GC.heap_dump <文件路径>
## curl -X POST http://localhost:8080/actuator/heapdump -o heapdump.hprof
```






## Spring

ApplicationContext也是一个可注入对象: 直接通过注解注入ApplicationContext类型 或者 实现ApplicationContextAware



在spring-mvc中的WebMvcConfigurer.addCorsMappings()中可以做到跨域, 但一旦和SpringSecurity结合使用就不能正常运行,这个结果是因为SpringSecurity注册的过滤器拦截了跨域的预检请求(到不了mvc中)

1.不使用mvc的配置,而是通过CorsFilter的Bean 

2.httpSecurity.addFilterBefore(corsFilter, JwtAuthenticationTokenFilter.class);

@PreAuthorize("permitAll")注解还是会拦截401

内部机制问题,由httpSecurity.anyRequest().authenticated()引起

有点莫名其妙..., 网上的回答更加莫名其妙...



配置文件加载的优先级（由高到低）

`bootstrap.properties ->bootstrap.yml -> application.properties -> application.yml`



Import

(1) @Import注解

(2) src/main/resources/META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports



@RefreshScope 配置刷新



Lombok @RequiredArgsConstructor



nacos服务注册 --spring.cloud.nacos.discovery.register-enabled=false



swagger版本问题

springboot2.5不需要额外配置

springboot2.6以上报错,需要额外补入MVC配置,二选一

​	@EnableMVC 

​	spring.mvc.pathmatch.strategy=*ant_path_matcher*



Binding注解, 在不注解时,默认当URL参数处理;当然form表单会有额外;

|            |                              |
| ---------- | ---------------------------- |
| FromQuery  | RequestParam (~~PathParam~~) |
| FromRoute  | PathVariable                 |
| FromHeader | RequestHeader                |
| FromBody   | RequestBody                  |
| FromForm   | RequestParam 或缺省?         |



HttpContext

通过请求参数中获取 Request 对象；  

```java
public void index(HttpServletRequest request) { }
```



通过 RequestContextHolder 获取 Request 对象；

```java
ServletRequestAttributes servletRequestAttributes = (ServletRequestAttributes)RequestContextHolder.getRequestAttributes();
HttpServletRequest request = servletRequestAttributes.getRequest();
```



通过自动注入获取 Request 对象;

```java
@Autowired
private HttpServletRequest request; // 自动注入 request 对象
```



## 测试

```java
@SpringBootTest(classes = ConfigurationExampleApplication.class, properties = {"--mail.enabled=true","--spring.profiles.active=dev,extra"})
```



## 注释链接

```
{@link SensitiveJsonSerializer}
```