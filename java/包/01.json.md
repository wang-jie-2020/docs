# JSON

## Jackson

```xml
<!-- **jackson-databind** 包含了 **jackson-annotations** **jackson-core** -->
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
</dependency>
```

*默认包含在web包中, 可以不再考虑单独新增, 但必须指出的在非SpringBoot场景下需要添加jsr310(比如LocalDateTime类型)同时进行配置处理*



常见的注解标记:

@JsonProperty(“xxx”)								字段不一致

@JsonValue										  字段值, 通常会考虑在枚举中替换默认输出

@JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")		格式化, shape + pattern, 通常处理枚举和日期

@JsonSerialize(using = ToStringSerializer.class)	控制序列化, 相对应的还有@JsonDeserialize

@JsonIgnore  @JsonIgnoreProperties  @JsonIgnoreType 控制忽略

@JsonManagedReference @JsonBackReference			控制循环引用

@JacksonAnnotationsInside  						 内联标记 --> 标记了@Sensitive 就像直接在那个元素上使用了 @JsonSerialize



常见的配置场景:

(1) 日期

默认的FORMAT @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss") 或者 spring.jackson.date-format = yyyy-MM-dd HH:mm:ss 可以控制Date类型, 但是LocalDateTime需要额外控制语句

```java
@Bean
public Jackson2ObjectMapperBuilderCustomizer jackson2ObjectMapperBuilderCustomizer() {
    return builder -> {
        builder.simpleDateFormat("yyyy-MM-dd HH:mm:ss");
        builder.serializerByType(LocalDateTime.class, 
                                 new LocalDateTimeSerializer(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss")));
        builder.deserializerByType(LocalDateTime.class, 
                                   new LocalDateTimeDeserializer(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss")));
    };
}
```

(2) 枚举

默认根据NAME进行转换, 偶尔也许有标注转换?

```java
@JsonValue
public String getCode()
{
    return code;
}
```

(3) LONG

```java
builder.serializerByType(long.class, new LongSerializer());	// extends JsonSerializer<Long> 
builder.serializerByType(Long.class, new LongSerializer()); // extends JsonSerializer<Long> 
```

(4) 配置重写

1. 定制 Jackson2ObjectMapperBuilderCustomizer Bean
2. 定制 MappingJackson2HttpMessageConverter Bean



## FastJson2

```xml
<dependency>
    <groupId>com.alibaba.fastjson2</groupId>
    <artifactId>fastjson2</artifactId>
</dependency>
```

*毁誉参半, 在api语法设计上明显会简便很多, 当然有方法可以配置为mvc的messageConverter, 必要性么就不再叙述了*



常见的注解标记:

@JSONField(name=”resType”) 

@JSONField(format=”yyyy-MM-dd”) 

@JSONField(serialize = false)



常见的配置场景:

暂略



配置

```java
JSON.configWriterDateFormat("yyyy-MM-dd HH:mm:ss");
JSON.register(LocalDateTime.class, LocalDateTimeReader.INSTANCE);
JSONFactory.setUseJacksonAnnotation(false);
```

在函数签名中可以传递更多配置

```java
static String toJSONString(Object object, Filter[] filters, JSONWriter.Feature... features)
```



## TAG

*在Fastjson的早期版本中是会被Jasckson的注解影响的(不可控制) https://github.com/alibaba/fastjson2/issues/716*, 在较新的版本中已经出现了全局控制 JSONFactory.setUseJacksonAnnotation(false);