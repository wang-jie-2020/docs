(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{355:function(e,t,a){"use strict";a.r(t);var s=a(4),n=Object(s.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"错误处理与测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#错误处理与测试"}},[e._v("#")]),e._v(" 错误处理与测试")]),e._v(" "),t("p",[e._v("defer-panic-and-recover")]),e._v(" "),t("p",[e._v("Go 有一个预先定义的 error 接口类型")]),e._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("type")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("error")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("interface")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("Error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[e._v("err "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":=")]),e._v(" errors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("New")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"math - square root of negative number"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("发生错误必须中止程序时，"),t("code",[e._v("panic()")]),e._v(" 可以用于错误处理模式")]),e._v(" "),t("blockquote",[t("p",[e._v("Go panicking：")]),e._v(" "),t("p",[e._v("在多层嵌套的函数调用中调用 "),t("code",[e._v("panic()")]),e._v("，可以马上中止当前函数的执行，所有的 "),t("code",[e._v("defer")]),e._v(" 语句都会保证执行并把控制权交还给接收到 panic 的函数调用者。这样向上冒泡直到最顶层，并执行（每层的） "),t("code",[e._v("defer")]),e._v("，在栈顶处程序崩溃，并在命令行中用传给 "),t("code",[e._v("panic()")]),e._v(" 的值报告错误情况：这个终止过程就是 "),t("em",[e._v("panicking")]),e._v("。")]),e._v(" "),t("p",[e._v("标准库中有许多包含 "),t("code",[e._v("Must")]),e._v(" 前缀的函数，像 "),t("code",[e._v("regexp.MustComplie()")]),e._v(" 和 "),t("code",[e._v("template.Must()")]),e._v("；当正则表达式或模板中转入的转换字符串导致错误时，这些函数会 "),t("code",[e._v("panic()")]),e._v("。")]),e._v(" "),t("p",[e._v("不能随意地用 "),t("code",[e._v("panic()")]),e._v(" 中止程序，必须尽力补救错误让程序能继续执行。")])]),e._v(" "),t("blockquote",[t("p",[e._v("正如名字一样，这个 ("),t("code",[e._v("recover()")]),e._v(") 内建函数被用于从 panic 或错误场景中恢复：让程序可以从 panicking 重新获得控制权，停止终止过程进而恢复正常执行。")]),e._v(" "),t("p",[t("code",[e._v("recover")]),e._v(" 只能在 "),t("code",[e._v("defer")]),e._v(" 修饰的函数（参见 "),t("a",{attrs:{href:"https://gitee.com/wangjie2020/the-way-to-go_ZH_CN/blob/master/eBook/06.4.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("6.4 节"),t("OutboundLink")],1),e._v("）中使用：用于取得 "),t("code",[e._v("panic()")]),e._v(" 调用中传递过来的错误值，如果是正常执行，调用 "),t("code",[e._v("recover()")]),e._v(" 会返回 "),t("code",[e._v("nil")]),e._v("，且没有其它效果。")]),e._v(" "),t("p",[e._v("总结："),t("code",[e._v("panic()")]),e._v(" 会导致栈被展开直到 "),t("code",[e._v("defer")]),e._v(" 修饰的 "),t("code",[e._v("recover()")]),e._v(" 被调用或者程序中止。")])])])}),[],!1,null,null,null);t.default=n.exports}}]);